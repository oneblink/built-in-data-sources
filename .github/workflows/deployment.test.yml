name: Test Deployment

on:
  push:
    branches:
      - master
      - 'hotfix/**'

jobs:
  #
  # OneBlink Tenant
  #
  OneBlinkTest:
    name: Test Deployment (OneBlink)
    if: ${{ !startsWith(github.event.head_commit.message, '[RELEASE]') }}
    uses: ./.github/workflows/deployment.yml
    with:
      CLI: oneblink
      SCOPE: oneblink-data-sources.api.test.oneblink.io
      ENV: prod
      ACCESS_KEY: ${{ vars.TEST_OB_ACCESS_KEY }}
    secrets:
      SECRET_KEY: ${{ secrets.TEST_OB_SECRET_KEY }}
  #
  # CivicPlus Tenant
  #
  CivicPlusTest:
    name: Test Deployment (CivicPlus)
    if: ${{ !startsWith(github.event.head_commit.message, '[RELEASE]') }}
    uses: ./.github/workflows/deployment.yml
    with:
      CLI: civicplus
      SCOPE: oneblink-data-sources.api.test.transform.civicplus.com
      ENV: prod
      ACCESS_KEY: ${{ vars.TEST_CP_ACCESS_KEY }}
    secrets:
      SECRET_KEY: ${{ secrets.TEST_CP_SECRET_KEY }}
  #
  # OneBlink US Tenant
  #
  OneBlinkUSTest:
    name: Test Deployment (OneBlink US)
    if: ${{ !startsWith(github.event.head_commit.message, '[RELEASE]') }}
    uses: ./.github/workflows/deployment.yml
    with:
      CLI: oneblink-us
      SCOPE: oneblink-data-sources.api.test.us.oneblink.io
      ENV: prod
      ACCESS_KEY: ${{ vars.TEST_OB_US_ACCESS_KEY }}
    secrets:
      SECRET_KEY: ${{ secrets.TEST_OB_US_SECRET_KEY }}
